!function t(e,n,r){function o(u,c){if(!n[u]){if(!e[u]){var s="function"==typeof require&&require;if(!c&&s)return s(u,!0);if(i)return i(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[u]={exports:{}};e[u][0].call(f.exports,function(t){var n=e[u][1][t];return o(n?n:t)},f,f.exports,t,e,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(t,e,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function o(t){t.forEach(function(t){var e='<option value="'+t.stop_name+" - "+t.stop_id+'"></option>';m.innerHTML+=e,y.innerHTML+=e})}function i(t,e){var n=document.getElementById("route-result"),r=document.getElementById("timetable");r.innerHTML="",n.style.opacity=1;var o=[],i=[];e.forEach(function(e){var n=t.filter(function(t){return t.trip_id==e.trip_id}).map(function(t){return'<option value="'+t.trip_id+'">'+t.arrival_time+"</option>"});i[e.route_id]+=n.join()}),e.forEach(function(t,e){if(o.indexOf(t.route_id)==-1){o.push(t.route_id);var n='<div class="row table"> \n                  <div class="col-33 cell">\n                    '+t.route_id+'\n                  </div>\n                  <div class="col-33 cell">\n                    '+t.service_id+'\n                  </div> \n                  <div class="col-33 cell">\n                    <select>'+i[t.route_id]+"</select>\n                  </div>\n                </div>";r.innerHTML+=n}})}function u(t,e){var n=document.getElementById("message-box");switch(n.innerHTML=t,n.className="alert",e){case"error":n.className+=" error";break;default:n.className+=" info"}}function c(){var t=document.getElementById("message-box");t.className="alert"}function s(){var t=document.getElementById("route-result"),e=document.getElementById("timetable");e.innerHTML="",t.style.opacity=0}function a(){g.getAll().then(o)}function f(t){var e=t.split("-");return e.length>1?e[1].trim():t}function l(t){var e=f(t);return g.getAll().then(function(t){return t.some(function(t){return t.stop_id==e})})}function p(t,e){var n=t.filter(function(t){return e.some(function(e){return e.trip_id==t.trip_id})});return n}function d(t,e){return Promise.all([w.getTripStopTimes(t),w.getTripStopTimes(e)]).then(function(t){var e=_(t,2),n=e[0],r=e[1],o=p(n,r);return{trips:o,routes:w.getRoutesForTrips(o)}})}function h(t){t.preventDefault(),c(),s();var e=document.getElementById("departure").value,n=document.getElementById("arrival").value;Promise.all([l(e),l(n)]).then(function(t){return t[0]&&t[1]?(d(f(e),f(n)).then(function(t){t.routes.then(function(e){e.length>0?i(t.trips,e):u("We couldn't find a trip between these two stations","error")})}),!1):(u("You have to select a valid departure and arrival stations from the lists or write a valid stop code.","error"),!1)})}function v(){m=document.getElementById("departure-stops"),y=document.getElementById("arrival-stops"),b=document.getElementById("search"),a(),b.addEventListener("click",h)}Object.defineProperty(n,"__esModule",{value:!0});var _=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var u,c=t[Symbol.iterator]();!(r=(u=c.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.init=v;var m,y,b,j=t("./orm/Stops.js"),g=r(j),x=t("./orm/Trips.js"),w=r(x),E=t("./http.js");r(E)},{"./http.js":2,"./orm/Stops.js":4,"./orm/Trips.js":5}],2:[function(t,e,n){"use strict";function r(t){return fetch(t,{method:"GET"}).then(function(t){return t.text()}).then(function(t){return h(t)}).catch(function(t){console.error(t)})}function o(){return r(s+a)}function i(){return r(s+f)}function u(){return r(s+l)}function c(){return r(s+p)}Object.defineProperty(n,"__esModule",{value:!0}),n.routes=o,n.trips=i,n.stops=u,n.stopTimes=c;var s="/dist/data/",a="routes.txt",f="trips.txt",l="stops.txt",p="stop_times.txt",d=function(t){var e=t.trim().split("\n");return e.map(function(t){return t.split(",")})},h=function(t){var e=d(t),n=e[0];return e=e.slice(1),e.map(function(t){var e={};return n.forEach(function(n,r){e[n]=t[r]}),e})}},{}],3:[function(t,e,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var o=t("./app.js"),i=r(o);!function(){function t(){navigator.serviceWorker&&navigator.serviceWorker.register("./service_worker.js",{scope:"/"}).then(function(t){!navigator.serviceWorker.controller}).catch(function(t){console.error("Registration failed!",t)})}function e(){return new Promise(function(t,e){document.addEventListener("readystatechange",function(){"loading"!==document.readyState&&t()})})}e().then(function(){i.init(),t()})}()},{"./app.js":1}],4:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function i(){return c.stops().then(function(t){return t?(0,a.default)().then(function(e){var n=e.transaction("stops","readwrite"),r=n.objectStore("stops");return t.forEach(function(t){r.put(t)}),n.complete}).then(function(){return t}):(0,a.default)().then(function(t){if(!t)throw"Stops data is not available.";var e=t.transaction("stops");return e.objectStore("stops").getAll()})})}Object.defineProperty(n,"__esModule",{value:!0}),n.getAll=i;var u=t("../http.js"),c=o(u),s=t("./db.js"),a=r(s)},{"../http.js":2,"./db.js":6}],5:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function i(){return(0,_.default)().then(function(t){if(!t)throw"We couldn't access IndexedDB";var e=t.transaction("trips"),n=e.objectStore("trips");return n.count()}).then(function(t){return t>0?Promise.resolve():h.stopTimes().then(u).then(h.trips).then(c)})}function u(t){if(t)return(0,_.default)().then(function(e){var n=e.transaction("stop_times","readwrite"),r=n.objectStore("stop_times");return t.forEach(function(t){r.put(t)}),n.complete}).catch(function(t){console.error(t)})}function c(t){if(t)return(0,_.default)().then(function(e){var n=e.transaction("trips","readwrite"),r=n.objectStore("trips");return t.forEach(function(t){r.put(t)}),n.complete}).catch(function(t){console.error(t)})}function s(t){return this.getTripsStopTimes(t).then()}function a(t){var e=[];return t.forEach(function(t){e.indexOf(t.trip_id)==-1&&e.push(t.trip_id)}),(0,_.default)().then(function(e){var n=e.transaction("trips"),r=n.objectStore("trips"),o=[];return t.forEach(function(t){o.push(r.get(t.trip_id))}),Promise.all(o)})}function f(t){return i().then(function(){return(0,_.default)()}).then(function(e){var n=e.transaction("stop_times"),r=n.objectStore("stop_times"),o=r.index("stop");return o.getAll(t)})}function l(t){}function p(t){}Object.defineProperty(n,"__esModule",{value:!0}),n.getRoutesForStop=s,n.getRoutesForTrips=a,n.getTripStopTimes=f,n.getTripsForRoute=l,n.getStopsForRoute=p;var d=t("../http.js"),h=o(d),v=t("./db.js"),_=r(v)},{"../http.js":2,"./db.js":6}],6:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(){return s.default.open("trains",1,function(t){switch(t.oldVersion){case 0:t.createObjectStore("stops",{keyPath:"stop_id"}),t.createObjectStore("trips",{keyPath:"trip_id"}),t.createObjectStore("stop_times",{autoIncrement:!0}),t.createObjectStore("routes",{keyPath:"route_id"});var e=t.transaction.objectStore("stop_times");e.createIndex("stop","stop_id"),e.createIndex("trip","trip_id")}})}function i(){return null==u&&(u=o()),u}Object.defineProperty(n,"__esModule",{value:!0}),n.default=i;var u,c=t("../../node_modules/idb/lib/idb.js"),s=r(c)},{"../../node_modules/idb/lib/idb.js":7}],7:[function(t,e,n){"use strict";!function(){function t(t){return Array.prototype.slice.call(t)}function n(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function r(t,e,r){var o,i=new Promise(function(i,u){o=t[e].apply(t,r),n(o).then(i,u)});return i.request=o,i}function o(t,e,n){var o=r(t,e,n);return o.then(function(t){if(t)return new f(t,o.request)})}function i(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]}})})}function u(t,e,n,o){o.forEach(function(o){o in n.prototype&&(t.prototype[o]=function(){return r(this[e],o,arguments)})})}function c(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function s(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return o(this[e],r,arguments)})})}function a(t){this._index=t}function f(t,e){this._cursor=t,this._request=e}function l(t){this._store=t}function p(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)}})}function d(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new p(n)}function h(t){this._db=t}i(a,"_index",["name","keyPath","multiEntry","unique"]),u(a,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),s(a,"_index",IDBIndex,["openCursor","openKeyCursor"]),i(f,"_cursor",["direction","key","primaryKey","value"]),u(f,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(f.prototype[t]=function(){var e=this,r=arguments;return Promise.resolve().then(function(){return e._cursor[t].apply(e._cursor,r),n(e._request).then(function(t){if(t)return new f(t,e._request)})})})}),l.prototype.createIndex=function(){return new a(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new a(this._store.index.apply(this._store,arguments))},i(l,"_store",["name","keyPath","indexNames","autoIncrement"]),u(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getAllKeys","count"]),s(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),c(l,"_store",IDBObjectStore,["deleteIndex"]),p.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},i(p,"_tx",["objectStoreNames","mode"]),c(p,"_tx",IDBTransaction,["abort"]),d.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},i(d,"_db",["name","version","objectStoreNames"]),c(d,"_db",IDBDatabase,["deleteObjectStore","close"]),h.prototype.transaction=function(){return new p(this._db.transaction.apply(this._db,arguments))},i(h,"_db",["name","version","objectStoreNames"]),c(h,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[l,a].forEach(function(n){n.prototype[e.replace("open","iterate")]=function(){var n=t(arguments),r=n[n.length-1],o=(this._store||this._index)[e].apply(this._store,n.slice(0,-1));o.onsuccess=function(){r(o.result)}}})}),[a,l].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(o){n.iterateCursor(t,function(t){return t?(r.push(t.value),void 0!==e&&r.length==e?void o(r):void t.continue()):void o(r)})})})});var v={open:function(t,e,n){var o=r(indexedDB,"open",[t,e]),i=o.request;return i.onupgradeneeded=function(t){n&&n(new d(i.result,t.oldVersion,i.transaction))},o.then(function(t){return new h(t)})},delete:function(t){return r(indexedDB,"deleteDatabase",[t])}};"undefined"!=typeof e?e.exports=v:self.idb=v}()},{}]},{},[3]);